\chapter{Conclusion and Future Work} \label{9ConcFuture}
\section{Conclusion}

Contiki has been ported to a BLE based platform, namely the nrf51822 \gls{soc} based PCA10000 board. nrf51822 was chosen as the \gls{soc} to work with after comparing various commercially available \glspl{soc} based on the various requirements from the platform. The port allowed all the basic peripherals of nrf51822 to be controlled by Contiki's libraries such as etimer, rtimer, serial-line and LEDs.  The radio was not included in the port since the radio was controlled by a SoftDevice binary for BLE operations and also since the Contiki radio \glspl{api} are not compatible with BLE operations. The test cases and the alarm application developed with Contiki verified its working with this platform. Compatibility of Contiki with a BLE based platform provides an event based OS to be used for developing BLE applications.

Two test suites were designed to compare four metrics of the link layer of BLE and 802.15.4, where 802.15.4 refers to use of 802.15.4 physical layer and use of either ContikMAC and Null-RDC \gls{mac} layer as the \gls{mac} layer. The four metrics that were compared were data rate, reliability, latency and energy consumption. Two test suites were designed to collect data of these four metrics and compare the two protocols. Some test cases also included presence of external interference caused by presence of heavy WiFi traffic. The scenario assumed was where one device is unconstrained with respect to availability of power while the other is not.

This thesis shows that the data rate achievable with 802.15.4 is greater than BLE due to the larger packet size and having the radio on 100\% of the time, although BLE consumes lesser energy. In case of BLE the data rate highly depends on the software stack being used. The data rate achievable with BLE is suitable for application up to streaming of audio.  

In terms of reliability, the error detection and retransmission of data has shown that the upper layer in BLE can consider the link layer as completely reliable. The frequency hopping mechanism of BLE ensures that any narrow band interference in the 2.4 GHz ISM band does not break down the communication. If the channels used for frequency hopping is chosen adaptively then the interference will not have any effect on BLE communication. Unlike in BLE, 802.15.4 does have a back-off mechanism to prevent communication in case there is external interference. This thesis shows that this mechanism has greater efficiency when there is lesser interference. 

BLE has better minimum latency than 802.15.4 although ContikiMAC with 125 ms wake up interval has better latency than BLE with 125 ms connection interval. The latency with a BLE connection for a request response operation depends on two connection parameters, namely connection interval and slave latency. The energy consumption also depends on these two parameters. The advantage of BLE over 802.15.4 is the ability of changing the connection parameters on the fly. This will allow optimizing the connection according to changing requirement depending on external conditions. 

%The conclusion is that now BLE can be used with Contiki and gained better understanding of the technology.
%By comparing with 15.4 we see that it has a competitive advantage in reliability and run-time reconfigurability.
%Mention that we expect this work to enable more research and product development in low-power IoT with Bluetooth.

One of the major strengths of BLE is its standardization with Bluetooth 4.0 core specification which has enabled its inclusion in millions of consumer devices. This has made it the communication protocol of choice for all the accessory devices which require human to machine communication. The standardization allows devices from different manufacturers to communicate with each other without issues. On the other hand 802.15.4 protocol is not adopted in major consumer devices. There has been extensive research on protocols based on 802.15.4 physical layer which has resulted in many standards being developed. There is native support for mesh network in protocols based on 802.15.4 which allows applications such as home automation and smart grid. This makes protocols based on 802.14.5 preferable for applications that require machine to machine communication.

Overall this work is expected to enable further research and product development in low-power IoT with Bluetooth Low Energy.

%In terms of the data rate, the 802.15.4's NullRDC layer achieved the highest at 155 kbps without Clear Channel Assesment (CCA). The effect of WiFi interference overlapping in the channel of communication in case 802.15.4 can be seen when the data rate reduced to 61 kbps from 148 kbps in the case where interference was in a different channel. With 802.15.4 the data rate can be maximized by having Radio Duty Cycle (RDC) of 100\%. The influence of frequency hopping in BLE can be noticed when the data rate decreased to only 23 kbps from 29 kbps when WiFi interference was introduced, both cases having RDC of around 27\%.  In BLE the effect of packets communicated per connection interval can be seen when communicating with an Android device as the data rate increased to 86 kbps, in which RDC was 44\%. 
%
%Use of 802.15.4's CCA delivered a Packet Reception Ratio (PRR) of 99\% and 79\% with and without WiFi interference respectively. In case of BLE, the link layer's the simple acknowledgment scheme achieved a Packet Delivery Ratio (PDR) of 100\%. Without WiFi interference, BLE achieved a PRR of almost 100\%. When WiFi interference was introduced, PRR resurged back to greater than 99\% when WiFi free channel map was used as compared to 80\% when complete channel map, which shows working of Adaptive Frequency Hopping (AFH).
%
%802.15.4's latency was measured as 24 ms with Null-RDC and 90 ms with ContikiMAC. With BLE latency values ranging from 14 ms to 750 ms were observed. These tests to measure latency show the influence of link layer parameters such as `connection interval' and `slave latency', as well as whether the data is queried by the master node or the slave node. The change in symmetry of the connection with non-zero slave latency can be seen in case where the latency changes from 16 ms to 736 ms when the test case changes from the slave querying the data to the master querying the data. The master's RDC of 22\% and slave's RDC of 0.6\% also indicates the asymmetry in the connection. With these different configurations, the different use cases are also illustrated.

%
%\begin{easylist}[itemize]
%& The absolute data rate achievable with 802.15.4 is higher than BLE on the account of the greater link-layer payload size, which is 110 byte for 802.15.4 and 27 byte for BLE. This is even with BLE having higher bit rate (1 Mbps) compared to 802.15.4 (250 kbps).
%& The highest data rate achieved with 802.15.4 is when \gls{cca} wasn't used (155 kbps), followed by communicating with a channel not overlapping with external interference using \gls{cca} (148 kbps).
%& When WiFi interference was present in the channel used, the lack of \gls{cca} resulted in higher data (114 kbps) rate as compared to \gls{cca} enabled (61 kbps).
%& In case of BLE, the highest data rate was recorded when communicating with an Android device (86 kbps), since the master device allowed multiple packets to be communicated in a connection interval. 
%& The data rate achieved between PCA10000 nodes was in-line with the theoretically calculated data rate when there was no external interference (29 kbps). This is the same case when WiFi free channel map was used with external interference. Since this is as if \gls{afh} is implemented, there is no degradation in the data rate. When there was WiFi interference and the complete channel map was used, the data rate dropped to only 80\% of the interference free data rate because of the frequency hopping.
%& The data rate achieved in BLE communication depends highly on the stack, which limits the deciding parameters of connection interval and packets communicated consistently in each connection interval.
%& \gls{cca} operation in 802.15.4 has greater efficiency in case of low external interference (99\% \gls{prr}) as compared to high external interference  (79\% \gls{prr}).
%& The acknowledgment scheme of BLE does result in 100\% \gls{pdr} for the layers above the link layer in all cases. The \gls{prr} with BLE is greater than 99\% when there was no external interference and when WiFi free channel map was used. 80\% \gls{prr} was achieved when all the channel map was used with external interference, which shows that narrow band interference affects only a small portion of the communication.
%& When one packet was communicated per connection interval, the \gls{rdc} was between 26 and 29\%. This value increased to about 44\% when an average of 3 packets were communicated per connection event.
%& Null-RDC with radio on always achieved least latency for 802.15.4 for a read-response operation with a mean delay of 24 ms. When the more practical ContikiMAC layer was used the mean delay increased to 90 ms, but with the responding node only having its radio on for 1.3\% of the time.
%& The latency measurement with BLE nodes ranged from 14 ms to 750 ms depending on the configuration. One directly contributing factor is the connection interval used. With a greater connection interval the latency also increased.
%& By using non-zero slave latency the slave node's energy consumption decreased and the effect on latency measurement was dependent on which node initiated the request for data. When the master node initiated the request for data the latency increased but when the slave node initiated the communication the latency was as in the case with zero slave latency. 
%& This ability of BLE to create asymmetric connection  can illustrated in the case where the slave device's energy consumption drops drastically without change in the latency when using indication packets. This can result in cases where 14 ms latency can be achieved by a master and slave node consuming only 21.5\% and 0.54\% radio on time.
%& Use cases where low latency is required for data to communicated from the master to slave, the slave latency value used must be close to zero. In other cases large slave latency values can be used. The provision for dynamic update of the link layer parameters of a BLE connection is useful in optimizing these parameters for different scenarios.
%
%\end{easylist}

\section{Future Work}

This project's experiments conducted only a subset of possible configurations with which both BLE and 802.15.4 could be used, although an overview has been provided. Various other configurations in terms of variation of the power constraint on the nodes, test case configuration and connection parameters can be used to gain better insight and comparison between BLE and 802.15.4.

The lack of availability of a complete and open-source BLE stack is one of the major inhibiting factors faced by researchers working with \gls{ble}. This results in little or no flexibility in developing the test setup as needed for the research projects. Contiki is a mature platform under active development for \gls{iot} projects. This thesis project can provide a start to active development of an open-source BLE stack and support for greater number of BLE based platforms in Contiki.

Bluetooth \gls{sig} has released the Bluetooth 4.1 Core Specification in December 2013, which provides numerous improvements to the existing features while adding support to various new features \cite{4.1ExtendsIoT}. This evolutionary update to Bluetooth lays the foundation to include IP based communication in the future updates \cite{4.0to4.1}. The organization Internet Engineering Task Force (IETF) has a working draft of the standard for communicating over IPv6 over BLE \cite{ieftIPv6Draft}, taking into account the Bluetooth 4.1 specification. This draft includes the addition of support for 6LowPAN over BLE. All these developments make it important to adopt these specifications to be compatible with the future devices and work on IPv6 communication over BLE. 

One of the major constraints of the BLE protocol is the lack of support for multi-hop networks. This has lead to the majority of usage in applications with human to machine communication. Enabling IPv6 communication and multi-hop network with BLE enables a host of additional applications in the \gls{iot} domain, just as BLE started the \emph{appcessories} market.
